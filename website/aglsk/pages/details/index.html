<!DOCTYPE html>
<html lang="pt-br" style="font-family: 'Gilroy-Regular', sans-serif;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do App</title>

  <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
  <script src="https://unpkg.com/mdui@2/mdui.global.js"></script>

  <link href="https://fonts.cdnfonts.com/css/gilroy-bold" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Two+Tone" rel="stylesheet">
  <link href="../../.././trindade/dev/css/mdui/styles.css" rel="stylesheet">
  <link href="../../.././trindade/dev/css/oak/card-style.css" rel="stylesheet">
  <link href="../../.././trindade/dev/css/oak/details/details.css" rel="stylesheet">
</head>
<body>
  <div class="app-detail" id="app-detail">
    <header class="app-header">
      <img id="app_logo" class="app_logo" src="https://via.placeholder.com/150" alt="App Logo" />
      <h2 id="app_title" class="mdui-typo-display-1 mdui-text-color-theme app-title">Nome do App</h2>
      <mdui-button onClick="openDownloadLink()" id="download_link">Baixar</mdui-button>
      <p id="app_developer" class="mdui-typo-subheading mdui-text-color-theme-secondary">Desenvolvedor do App</p>
      <img id="dev_photo" src="https://via.placeholder.com/100" alt="Dev Photo" class="mdui-img-circle" style="width: 50px; height: 50px;">
    </header>

    <hr class="mdui-divider">

    <section class="app-description mdui-typo">
      <h3 class="mdui-typo-title">Descrição</h3>
      <p id="app_description"></p>
    </section>

    <hr class="mdui-divider">

    <section class="app-screenshots mdui-typo">
      <h3 class="mdui-typo-title">Capturas de Tela</h3>
      <div class="mdui-row" id="app_screenshots">
        <!-- Screenshots will be inserted here -->
      </div>
    </section>

    <hr class="mdui-divider">

    <section class="app-features mdui-typo">
      <h3 class="mdui-typo-title">Funcionalidades</h3>
      <ul id="app_features" class="mdui-list">
        <!-- Features will be added here -->
      </ul>
    </section>

    <hr class="mdui-divider">

    <section class="app-category mdui-typo">
      <h3 class="mdui-typo-title">Categoria</h3>
      <p id="app_category"></p>
    </section>

    <hr class="mdui-divider">

    <section class="app-tags mdui-typo">
      <h3 class="mdui-typo-title">Tags</h3>
      <p id="app_tags"></p>
    </section>

    <hr class="mdui-divider">

    <section class="app-number-downloads mdui-typo">
      <h3 class="mdui-typo-title">Número de Downloads</h3>
      <p id="number_of_downloads"></p>
    </section>

    <hr class="mdui-divider">
  </div>

  <script>
    // Função para abrir o link de download
    function openDownloadLink() {
      window.location.href = DOWNLOAD_URL;
    }

    // Função para carregar os dados do aplicativo
    async function fetchData() {
      const params = window.location.hash.substring(2).split('/');
      const project_name = params[1];
      const project_dev_name = params[0];

      if (project_dev_name && project_name) {
        try {
          const response = await fetch(`https://oak-api-alpha.vercel.app/app/${project_dev_name}/${project_name}`);
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          const data = await response.json();
          console.log(data);

          if (!data || Object.keys(data).length === 0) {
            throw new Error('No data found');
          }

          // Atualiza os elementos HTML com os dados do aplicativo
          document.getElementById('app_title').textContent = data['app_name'] || '';
          document.getElementById('app_developer').textContent = data['app_dev_name'] || '';
          document.getElementById('app_description').textContent = data['app_description'] || '';
          document.getElementById('app_category').textContent = data['app_category'] || '';
          document.getElementById('app_tags').textContent = data['app_tags'] || '';
          document.getElementById('number_of_downloads').textContent = data['app_downloads'] || '';
          document.getElementById('app_logo').src = data['app_photo'] || 'https://via.placeholder.com/150';
          document.getElementById('dev_photo').src = data['app_dev_photo'] || 'https://via.placeholder.com/100';
          DOWNLOAD_URL = data['app_download_url'] || '';

          // Preenche a lista de funcionalidades
          const features = data['app_functions'] ? data['app_functions'].split(',') : [];
          const featuresList = document.getElementById('app_features');
          featuresList.innerHTML = '';
          features.forEach(feature => {
            const li = document.createElement('li');
            li.className = 'mdui-list-item mdui-ripple';
            li.textContent = feature.trim();
            featuresList.appendChild(li);
          });

          // Adiciona as capturas de tela
          const screenshots = data['app_screenshots'] ? data['app_screenshots'].split(',') : [];
          const screenshotsDiv = document.getElementById('app_screenshots');
          screenshotsDiv.innerHTML = '';
          screenshots.forEach(screenshot => {
            const div = document.createElement('div');
            div.className = 'mdui-col-xs-4';
            const img = document.createElement('img');
            img.src = screenshot.trim();
            img.className = 'mdui-img-fluid';
            div.appendChild(img);
            screenshotsDiv.appendChild(div);
          });

        } catch (error) {
          console.error('Fetch error: ', error);
          document.getElementById('app-detail').innerHTML = `<p>Erro ao carregar os dados: ${error.message}</p>`;
        }
      } else {
        document.getElementById('app-detail').innerHTML = '<p>Nome do aplicativo não fornecido na URL.</p>';
      }
    }

    // Carrega os dados ao carregar o DOM
    document.addEventListener('DOMContentLoaded', fetchData);
  </script>

  <script src="../../.././trindade/dev/js/oak/details/details.js"></script>
  <script src="../../.././trindade/dev/js/oak/theme/manager.js"></script>
</body>
</html>
